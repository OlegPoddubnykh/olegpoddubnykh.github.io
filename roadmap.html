<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imot.io Marketing Roadmap 2025</title>
    <style>
        :root {
            --okr1: #e74c3c;
            --okr2: #2ecc71;
            --okr3: #f1c40f;
            --okr4: #9b59b6;
            --bg: #f8f9fa;
            --text: #2c3e50;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        select, button {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: 0.2s;
        }

        select:hover, button:hover {
            border-color: var(--okr1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        button.active {
            background-color: var(--text);
            color: white;
        }

        .gantt-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .gantt-chart {
            display: grid;
            gap: 5px;
            min-width: 100%;
            padding: 20px 0;
            grid-auto-rows: minmax(45px, auto);
        }

        .month-header {
            text-align: center;
            padding: 10px;
            font-weight: 500;
            position: sticky;
            top: 0;
            background: white;
            z-index: 2;
            border-bottom: 2px solid var(--bg);
        }

        .task-row {
            display: contents;
            position: relative;
        }

        .task-info {
            padding: 12px;
            position: sticky;
            left: 0;
            background: white;
            z-index: 1;
            border-right: 2px solid var(--bg);
        }

        .task-bar {
            height: 36px;
            border-radius: 6px;
            margin: 4px 0;
            position: relative;
            transition: 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 10px;
            color: white;
            font-size: 0.9em;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .task-bar:hover {
            filter: brightness(1.1);
            transform: scaleY(1.05);
            z-index: 3;
        }

        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 12px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: 0.2s;
            min-width: 300px;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 20px;
            transition: 0.2s;
        }

        .legend-item:hover {
            background: rgba(0,0,0,0.05);
        }

        .legend-item.filtered {
            opacity: 0.5;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .stats {
            margin-top: 30px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stats-title {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-card {
            padding: 15px;
            border-radius: 8px;
            background: var(--bg);
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            color: rgba(44, 62, 80, 0.7);
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .gantt-chart {
                grid-template-columns: 200px repeat(12, 100px);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">
                <h1>üöÄ Imot.io Marketing Roadmap 2025</h1>
            </div>
            <div class="filters">
                <select id="okrFilter">
                    <option value="all">–í—Å–µ OKR</option>
                    <option value="1">Objective 1: +2 –º–ª–Ω MRR</option>
                    <option value="2">Objective 2: –£–ø—Ä–æ—â–µ–Ω–∏–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è</option>
                    <option value="3">Objective 3: ESOV</option>
                    <option value="4">Objective 4: –ü—Ä–æ—Ü–µ—Å—Å—ã</option>
                </select>
                <select id="ownerFilter">
                    <option value="all">–í—Å–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</option>
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </select>
                <select id="periodFilter">
                    <option value="all">–í–µ—Å—å –ø–µ—Ä–∏–æ–¥</option>
                    <option value="q1">Q1 2025</option>
                    <option value="q2">Q2 2025</option>
                    <option value="q3">Q3 2025</option>
                    <option value="q4">Q4 2025</option>
                </select>
                <button id="toggleView" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥">–ö–≤–∞—Ä—Ç–∞–ª—å–Ω–æ</button>
            </div>
        </div>

        <div class="gantt-container">
            <div class="gantt-chart" id="ganttChart"></div>
        </div>

        <div class="legend">
            <div class="legend-item" data-okr="1">
                <div class="legend-color" style="background: var(--okr1)"></div>
                <span>Objective 1: +2 –º–ª–Ω MRR</span>
            </div>
            <div class="legend-item" data-okr="2">
                <div class="legend-color" style="background: var(--okr2)"></div>
                <span>Objective 2: –£–ø—Ä–æ—â–µ–Ω–∏–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è</span>
            </div>
            <div class="legend-item" data-okr="3">
                <div class="legend-color" style="background: var(--okr3)"></div>
                <span>Objective 3: ESOV</span>
            </div>
            <div class="legend-item" data-okr="4">
                <div class="legend-color" style="background: var(--okr4)"></div>
                <span>Objective 4: –ü—Ä–æ—Ü–µ—Å—Å—ã</span>
            </div>
        </div>

        <div class="stats">
            <h2 class="stats-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalTasks">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="inProgressTasks">0</div>
                    <div class="stat-label">–ó–∞–¥–∞—á –≤ —Ä–∞–±–æ—Ç–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedTasks">0</div>
                    <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="upcomingTasks">0</div>
                    <div class="stat-label">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–¥–∞—á</div>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

<script>
const tasks = [
    {
        id: 1,
        okr: 1,
        kr: '1.1',
        name: '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Roistat –∏ CRM (—Å–∫–≤–æ–∑–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, CPL/CAC)',
        start: '2025-05-01',
        end: '2025-05-31',
        owner: '–û–ª–µ–≥',
        metrics: 'CAC: ~120k ‚Üí ‚â§80k, –ù–æ–≤—ã–π MRR ~300k ‚Üí 600k',
        status: 'not-started'
    },
    {
        id: 2,
        okr: 1,
        kr: '1.1',
        name: '–ü—Ä–æ–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã ABM (—Ü–µ–ø–æ—á–∫–∏ –ø–∏—Å–µ–º –∏ –∑–≤–æ–Ω–∫–æ–≤) + –ê–ù–ê–õ–ò–¢–ò–ö–ê, –û–¢–ß–ï–¢–ù–û–°–¢–¨',
        start: '2025-05-01',
        end: '2025-05-31',
        owner: '–°—Ç–µ–ø–∞–Ω, –û–ª–µ–≥',
        metrics: '3 —Ü–µ–ø–æ—á–∫–∏ (–º–µ–¥, EdTech, +1)',
        status: 'not-started'
    },
    {
        id: 3,
        okr: 1,
        kr: '1.1',
        name: '–°–æ–±—Ä–∞—Ç—å –±–∞–∑—É –¥–ª—è ABM (–º–µ–¥, EdTech), 100-200 –∫–æ–º–ø–∞–Ω–∏–π –Ω–∞ –æ—Ç—Ä–∞—Å–ª—å',
        start: '2025-05-01',
        end: '2025-06-15',
        owner: '–°—Ç–µ–ø–∞–Ω',
        metrics: '100 –∫–æ–º–ø–∞–Ω–∏–π –≤ CRM',
        status: 'not-started'
    },
    {
        id: 4,
        okr: 1,
        kr: '1.1',
        name: '–ù–∞–π—Ç–∏ email —Ä–∞—Å—Å—ã–ª–∫–∏ –¥–ª—è —É—á–∞—Å—Ç–∏—è (5 —Ä–∞–∑–Ω—ã—Ö)',
        start: '2025-05-15',
        end: '2025-12-31',
        owner: '–û–ª–µ–≥, –î–∞–Ω–∏–∏–ª, –°—Ç–µ–ø–∞–Ω',
        metrics: '5 —Ä–∞—Å—Å—ã–ª–æ–∫',
        status: 'not-started'
    },
    {
        id: 5,
        okr: 1,
        kr: '1.1',
        name: '–¢–∞—Ä–≥–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ (–∫–µ–π—Å—ã)',
        start: '2025-04-30',
        end: '2025-12-31',
        owner: '–û–ª–µ–≥, –ø–æ–¥—Ä—è–¥—á–∏–∫',
        metrics: 'CAC ‚â§80k',
        status: 'in-progress'
    },
    {
        id: 6,
        okr: 1,
        kr: '1.1',
        name: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π (–∫–æ–Ω—Ç–µ–∫—Å—Ç + –º–µ–¥–∏–π–∫–∞)',
        start: '2025-04-15',
        end: '2025-12-31',
        owner: '–û–ª–µ–≥, –ø–æ–¥—Ä—è–¥—á–∏–∫',
        metrics: 'CAC ‚â§80k',
        status: 'in-progress'
    },
    {
        id: 7,
        okr: 1,
        kr: '1.1',
        name: 'SEO',
        start: '2025-04-15',
        end: '2025-12-31',
        owner: '–û–ª–µ–≥, –ø–æ–¥—Ä—è–¥—á–∏–∫',
        metrics: 'CAC ‚â§80k',
        status: 'in-progress'
    },
    {
        id: 8,
        okr: 1,
        kr: '1.1',
        name: '–£—á–∞—Å—Ç–∏–µ –≤ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è—Ö –∏ –≤—ã—Å—Ç–∞–≤–∫–∞—Ö',
        start: '2025-07-01',
        end: '2025-12-31',
        owner: '–û–ª–µ–≥, –¢–∞–º–∞—Ä–∞',
        metrics: '15 –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, CAC ‚â§200k',
        status: 'not-started'
    },
    {
        id: 9,
        okr: 1,
        kr: '1.2',
        name: '–õ–µ–Ω–¥–∏–Ω–≥ –ø–æ–¥ 2 –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ (–º–µ–¥, EdTech)',
        start: '2025-05-01',
        end: '2025-05-30',
        owner: '–û–ª–µ–≥, –Æ–ª–∏—è',
        metrics: '2 –ª–µ–Ω–¥–∏–Ω–≥–∞',
        status: 'not-started'
    },
    {
        id: 10,
        okr: 1,
        kr: '1.2',
        name: '–û—Ñ—Ñ–µ—Ä—ã –¥–ª—è upsell',
        start: '2025-05-15',
        end: '2025-05-30',
        owner: '–¢–∞–º–∞—Ä–∞',
        metrics: '–í–æ—Ä–æ–Ω–∫–∞ –¥–æ–ø—Ä–æ–¥–∞–∂',
        status: 'not-started'
    },
    {
        id: 11,
        okr: 1,
        kr: '1.2',
        name: '–ù–∞–ø–∏—Å–∞–Ω–∏–µ –∫–µ–π—Å–æ–≤ (–§–æ–º–∏–Ω–∞, Lerna)',
        start: '2025-06-01',
        end: '2025-06-15',
        owner: '–û–ª–µ–≥, –í–∏–∫—Ç–æ—Ä–∏—è, –ê–Ω–∞—Å—Ç–∞—Å–∏—è –ö—É–ø—Ü–æ–≤–∞',
        metrics: '2 –∫–µ–π—Å–∞',
        status: 'not-started'
    },
    {
        id: 12,
        okr: 1,
        kr: '1.2',
        name: '–û—Ç—á–µ—Ç—ã –∏ –∞–∫–∫–∞—É–Ω—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç',
        start: '2025-04-30',
        end: '2025-12-31',
        owner: '–û–ª–µ–≥, –í–∏–∫—Ç–æ—Ä–∏—è',
        metrics: '–û—Ç—Ç–æ–∫ ‚â§300k',
        status: 'in-progress'
    },
    {
        id: 13,
        okr: 2,
        kr: '2.2',
        name: '–ì–æ—Ç–æ–≤—ã–µ —Å–ª–æ–≤–∞—Ä–∏ –∏ –≥–∞–π–¥—ã',
        start: '2025-07-01',
        end: '2025-07-31',
        owner: '–û–ª–µ–≥, –ê–Ω–∞—Å—Ç–∞—Å–∏—è –°–æ–∫–æ–ª–æ–≤–∞',
        metrics: '–û–Ω–±–æ—Ä–¥–∏–Ω–≥ 14 –¥–Ω–µ–π',
        status: 'not-started'
    },
    {
        id: 14,
        okr: 2,
        kr: '2.3',
        name: '–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã',
        start: '2025-05-15',
        end: '2025-05-30',
        owner: '–û–ª–µ–≥, –¢–∞–º–∞—Ä–∞, –ø–æ–¥—Ä—è–¥—á–∏–∫',
        metrics: 'CR +2-3%',
        status: 'not-started'
    },
    {
        id: 15,
        okr: 2,
        kr: '2.3',
        name: '–ò–∑—É—á–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤',
        start: '2025-07-01',
        end: '2025-07-15',
        owner: '–û–ª–µ–≥, –¢–∞–º–∞—Ä–∞, –í–∏–∫—Ç–æ—Ä–∏—è',
        metrics: 'CAC ‚â§80k',
        status: 'not-started'
    },
    {
        id: 16,
        okr: 3,
        kr: '3.1',
        name: '–ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –°–ú–ò',
        start: '2025-09-01',
        end: '2025-11-30',
        owner: '–û–ª–µ–≥, –¢–∞–º–∞—Ä–∞',
        metrics: '8 –ø—É–±–ª–∏–∫–∞—Ü–∏–π',
        status: 'not-started'
    },
    {
        id: 17,
        okr: 3,
        kr: '3.1',
        name: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–±–æ—Ä–∞ –∑–∞–ø—Ä–æ—Å–æ–≤',
        start: '2025-05-01',
        end: '2025-12-31',
        owner: '–û–ª–µ–≥, –¢–∞–º–∞—Ä–∞',
        metrics: '–°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞',
        status: 'not-started'
    },
    {
        id: 18,
        okr: 3,
        kr: '3.2',
        name: '–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ–π—Å–æ–≤ (–≤–∏–¥–µ–æ/—Ç–µ–∫—Å—Ç)',
        start: '2025-09-01',
        end: '2025-09-15',
        owner: '–ö–æ–Ω—Ç–µ–Ω—Ç, –í–∏–¥–µ–æ–≥—Ä–∞—Ñ, –®—É–ª—å–≥–∞',
        metrics: '5-6 –∫–µ–π—Å–æ–≤',
        status: 'not-started'
    },
    {
        id: 19,
        okr: 3,
        kr: '3.3',
        name: 'Telegram-–∫–∞–Ω–∞–ª',
        start: '2025-07-01',
        end: '2025-07-15',
        owner: '–¢–∞–º–∞—Ä–∞, –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç (X)',
        metrics: '+30% —Ç—Ä–∞—Ñ–∏–∫–∞',
        status: 'not-started'
    },
    {
        id: 20,
        okr: 3,
        kr: '3.3',
        name: '–ú–∞—Å—à—Ç–∞–±–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
        start: '2025-08-01',
        end: '2025-08-15',
        owner: '–û–ª–µ–≥, –ê–Ω–∞—Å—Ç–∞—Å–∏—è –°–æ–∫–æ–ª–æ–≤–∞, –¢–∞–º–∞—Ä–∞',
        metrics: '–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç',
        status: 'not-started'
    },
    {
        id: 21,
        okr: 3,
        kr: '3.3',
        name: '–£—á–∞—Å—Ç–∏–µ –≤ —Ä–µ–π—Ç–∏–Ω–≥–∞—Ö',
        start: '2025-06-01',
        end: '2025-12-31',
        owner: '–û–ª–µ–≥, –¢–∞–º–∞—Ä–∞',
        metrics: '3 –Ω–∞–≥—Ä–∞–¥—ã',
        status: 'not-started'
    },
    {
        id: 22,
        okr: 3,
        kr: '3.3',
        name: '–≠–¥—Ç–µ—Ö-–ø—Ä–æ–µ–∫—Ç—ã –∫–∞–∫ –∞–≤—Ç–æ—Ä—ã',
        start: '2025-07-01',
        end: '2025-07-15',
        owner: '–¢–∞–º–∞—Ä–∞, –ê–Ω–∞—Å—Ç–∞—Å–∏—è –°–æ–∫–æ–ª–æ–≤–∞',
        metrics: '3 –ø—Ä–æ–µ–∫—Ç–∞',
        status: 'not-started'
    },
    {
        id: 23,
        okr: 3,
        kr: '3.3',
        name: '–ú–µ—Ç–æ–¥–∏—á–∫–∞ SPEECH',
        start: '2025-07-01',
        end: '2025-07-15',
        owner: '–û–ª–µ–≥, –¢–∞–º–∞—Ä–∞',
        metrics: '–ì–æ—Ç–æ–≤–∞—è –º–µ—Ç–æ–¥–∏—á–∫–∞',
        status: 'not-started'
    },
    {
        id: 24,
        okr: 4,
        kr: '4.1',
        name: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏',
        start: '2025-05-01',
        end: '2025-12-31',
        owner: 'All the Heads',
        metrics: '–î–∞—à–±–æ—Ä–¥ –º–µ—Ç—Ä–∏–∫',
        status: 'not-started'
    },
    {
        id: 25,
        okr: 4,
        kr: '4.2',
        name: '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CRM',
        start: '2025-08-01',
        end: '2025-12-31',
        owner: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ç–∏–º–ª–∏–¥, –ê–Ω–∞—Å—Ç–∞—Å–∏—è –°–æ–∫–æ–ª–æ–≤–∞, –û–ª–µ–≥',
        metrics: '5 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π',
        status: 'not-started'
    },
    {
        id: 26,
        okr: 4,
        kr: '4.3',
        name: 'Email-—Ä–∞—Å—Å—ã–ª–∫–∏ –∏ –≤–µ–±–∏–Ω–∞—Ä—ã',
        start: '2025-05-01',
        end: '2025-12-31',
        owner: '–í–∏–∫—Ç–æ—Ä–∏—è, –¢–∞–º–∞—Ä–∞, –ö–æ–Ω—Ç–µ–Ω—Ç',
        metrics: '–û—Ç–∫—Ä—ã–≤–∞–µ–º–æ—Å—Ç—å >30%',
        status: 'not-started'
    },
    {
        id: 27,
        okr: 4,
        kr: '4.4',
        name: '–°–±–æ—Ä –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (NPS)',
        start: '2025-05-01',
        end: '2025-12-31',
        owner: '–í–∏–∫—Ç–æ—Ä–∏—è, –¢–∞–º–∞—Ä–∞',
        metrics: 'NPS +8',
        status: 'not-started'
    },
    {
        id: 28,
        okr: 4,
        kr: '4.5',
        name: '–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç-–æ—Ç–¥–µ–ª–∞',
        start: '2025-07-01',
        end: '2025-12-31',
        owner: 'CMO, HR',
        metrics: '2 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞',
        status: 'not-started'
    }
];

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
let currentView = 'monthly'; // monthly –∏–ª–∏ quarterly
let filteredOkrs = [];

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
function populateOwnerFilter() {
    const ownerFilter = document.getElementById('ownerFilter');
    const owners = new Set();
    
    tasks.forEach(task => {
        if (task.owner) {
            const taskOwners = task.owner.split(', ');
            taskOwners.forEach(owner => {
                // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω
                let normalizedOwner = owner.trim();
                if (normalizedOwner.toLowerCase() === '–∫–æ–Ω—Ç–µ–Ω—Ç' || normalizedOwner.toLowerCase() === '–∫–æ–Ω—Ç–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä') {
                    normalizedOwner = '–ö–æ–Ω—Ç–µ–Ω—Ç';
                }
                owners.add(normalizedOwner);
            });
        }
    });
    
    const sortedOwners = Array.from(owners).sort();
    
    // –û—á–∏—â–∞–µ–º –ø–µ—Ä–µ–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
    while (ownerFilter.options.length > 1) {
        ownerFilter.remove(1);
    }
    
    sortedOwners.forEach(owner => {
        const option = document.createElement('option');
        option.value = owner;
        option.textContent = owner;
        ownerFilter.appendChild(option);
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateStats() {
    const today = new Date();
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
    const filteredTasks = tasks.filter(task => {
        const okrMatch = document.getElementById('okrFilter').value === 'all' || task.okr.toString() === document.getElementById('okrFilter').value;
        const ownerMatch = document.getElementById('ownerFilter').value === 'all' || task.owner.includes(document.getElementById('ownerFilter').value);
        return okrMatch && ownerMatch;
    });
    
    document.getElementById('totalTasks').textContent = filteredTasks.length;
    
    const inProgress = filteredTasks.filter(task => {
        const startDate = new Date(task.start);
        const endDate = new Date(task.end);
        return startDate <= today && endDate >= today;
    }).length;
    
    const completed = filteredTasks.filter(task => {
        const endDate = new Date(task.end);
        return endDate < today;
    }).length;
    
    const upcoming = filteredTasks.filter(task => {
        const startDate = new Date(task.start);
        return startDate > today;
    }).length;
    
    document.getElementById('inProgressTasks').textContent = inProgress;
    document.getElementById('completedTasks').textContent = completed;
    document.getElementById('upcomingTasks').textContent = upcoming;
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–∏–∞–≥—Ä–∞–º–º—ã –ì–∞–Ω—Ç–∞
function renderGantt() {
    const okrFilter = document.getElementById('okrFilter').value;
    const ownerFilter = document.getElementById('ownerFilter').value;
    const periodFilter = document.getElementById('periodFilter').value;
    
    const chart = document.getElementById('ganttChart');
    chart.innerHTML = '';
    
    let timeHeaders;
    let gridColumns;
    
    if (currentView === 'monthly') {
        timeHeaders = [
            '–ê–ø—Ä 2025', '–ú–∞–π 2025', '–ò—é–Ω 2025', '–ò—é–ª 2025', '–ê–≤–≥ 2025', '–°–µ–Ω 2025',
            '–û–∫—Ç 2025', '–ù–æ—è 2025', '–î–µ–∫ 2025'
        ];
        // –û–±–Ω–æ–≤–ª—è–µ–º CSS –¥–ª—è —Å–µ—Ç–∫–∏ –ø—Ä–∏ –º–µ—Å—è—á–Ω–æ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏
        chart.style.gridTemplateColumns = '300px repeat(9, 1fr)';
    } else {
        timeHeaders = ['Q2 2025', 'Q3 2025', 'Q4 2025'];
        // –û–±–Ω–æ–≤–ª—è–µ–º CSS –¥–ª—è —Å–µ—Ç–∫–∏ –ø—Ä–∏ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏  
        chart.style.gridTemplateColumns = '300px repeat(3, 1fr)';
    }
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    const headerInfo = document.createElement('div');
    headerInfo.className = 'month-header';
    headerInfo.textContent = '–ó–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞';
    chart.appendChild(headerInfo);
    
    // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
    timeHeaders.forEach(header => {
        const headerCell = document.createElement('div');
        headerCell.className = 'month-header';
        headerCell.textContent = header;
        chart.appendChild(headerCell);
    });
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á
    const filteredTasks = tasks.filter(task => {
        const okrMatch = okrFilter === 'all' || task.okr.toString() === okrFilter;
        const ownerMatch = ownerFilter === 'all' || task.owner.includes(ownerFilter);
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–µ—Ä–∏–æ–¥—É
        let periodMatch = true;
        if (periodFilter !== 'all') {
            const startDate = new Date(task.start);
            const endDate = new Date(task.end);
            
            if (periodFilter === 'q1') {
                periodMatch = (startDate <= new Date('2025-03-31') && endDate >= new Date('2025-01-01'));
            } else if (periodFilter === 'q2') {
                periodMatch = (startDate <= new Date('2025-06-30') && endDate >= new Date('2025-04-01'));
            } else if (periodFilter === 'q3') {
                periodMatch = (startDate <= new Date('2025-09-30') && endDate >= new Date('2025-07-01'));
            } else if (periodFilter === 'q4') {
                periodMatch = (startDate <= new Date('2025-12-31') && endDate >= new Date('2025-10-01'));
            }
        }
        
        return okrMatch && ownerMatch && periodMatch;
    });
    
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ OKR, KR –∏ –¥–∞—Ç–µ –Ω–∞—á–∞–ª–∞
    filteredTasks.sort((a, b) => {
        if (a.okr !== b.okr) return a.okr - b.okr;
        if (a.kr !== b.kr) return a.kr.localeCompare(b.kr);
        return new Date(a.start) - new Date(b.start);
    });
    
    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á
    filteredTasks.forEach(task => {
        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–¥–∞—á–µ
        const info = document.createElement('div');
        info.className = 'task-info';
        info.innerHTML = `
            <div><strong>${task.kr}</strong> ${task.name}</div>
            <small>${task.owner || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ'}</small>
        `;
        chart.appendChild(info);
        
        // –°–æ–∑–¥–∞–µ–º —è—á–µ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
        for (let i = 0; i < timeHeaders.length; i++) {
            const cell = document.createElement('div');
            
            const taskStartDate = new Date(task.start);
            const taskEndDate = new Date(task.end);
            let inPeriod = false;
            
            if (currentView === 'monthly') {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ –∑–∞–¥–∞—á–∞ –≤ —ç—Ç–æ—Ç –º–µ—Å—è—Ü
                const monthYear = timeHeaders[i].split(' ');
                const month = getMonthNumber(monthYear[0]);
                const year = parseInt(monthYear[1]);
                
                const periodStart = new Date(year, month, 1);
                const periodEnd = new Date(year, month + 1, 0);
                
                inPeriod = (taskStartDate <= periodEnd && taskEndDate >= periodStart);
            } else {
                // –î–ª—è –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                const quarter = timeHeaders[i].split(' ')[0].substring(1);
                const year = parseInt(timeHeaders[i].split(' ')[1]);
                
                let quarterStart, quarterEnd;
                if (quarter === '2') {
                    quarterStart = new Date(year, 3, 1); // –ê–ø—Ä–µ–ª—å
                    quarterEnd = new Date(year, 5, 30); // –ò—é–Ω—å
                } else if (quarter === '3') {
                    quarterStart = new Date(year, 6, 1); // –ò—é–ª—å
                    quarterEnd = new Date(year, 8, 30); // –°–µ–Ω—Ç—è–±—Ä—å
                } else if (quarter === '4') {
                    quarterStart = new Date(year, 9, 1); // –û–∫—Ç—è–±—Ä—å
                    quarterEnd = new Date(year, 11, 31); // –î–µ–∫–∞–±—Ä—å
                }
                
                inPeriod = (taskStartDate <= quarterEnd && taskEndDate >= quarterStart);
            }
            
            // –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –µ–µ
            if (inPeriod) {
                const bar = document.createElement('div');
                bar.className = 'task-bar';
                bar.style.backgroundColor = `var(--okr${task.okr})`;
                
                // –í –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏ –≤ –ø–æ–ª–æ—Å—É
                if (currentView === 'quarterly') {
                    bar.textContent = task.name;
                }
                
                // –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                bar.addEventListener('mouseover', (e) => {
                    const tooltip = document.getElementById('tooltip');
                    tooltip.innerHTML = `
                        <strong>${task.name}</strong><br>
                        <small>OKR ${task.okr} ‚Ä¢ KR ${task.kr}</small><br><br>
                        üìÖ ${formatDate(task.start)} - ${formatDate(task.end)}<br>
                        üë§ ${task.owner || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ'}<br>
                        üìä ${task.metrics}
                    `;
                    tooltip.style.opacity = 1;
                    tooltip.style.left = `${e.pageX + 15}px`;
                    tooltip.style.top = `${e.pageY + 15}px`;
                });

                bar.addEventListener('mouseout', () => {
                    document.getElementById('tooltip').style.opacity = 0;
                });

                cell.appendChild(bar);
            }
            
            chart.appendChild(cell);
        }
    });
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    updateStats();
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function getMonthNumber(monthName) {
    const months = {
        '–Ø–Ω–≤': 0, '–§–µ–≤': 1, '–ú–∞—Ä': 2, '–ê–ø—Ä': 3, '–ú–∞–π': 4, '–ò—é–Ω': 5,
        '–ò—é–ª': 6, '–ê–≤–≥': 7, '–°–µ–Ω': 8, '–û–∫—Ç': 9, '–ù–æ—è': 10, '–î–µ–∫': 11
    };
    return months[monthName];
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('ru-RU');
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
document.getElementById('okrFilter').addEventListener('change', renderGantt);
document.getElementById('ownerFilter').addEventListener('change', renderGantt);
document.getElementById('periodFilter').addEventListener('change', renderGantt);

document.getElementById('toggleView').addEventListener('click', function() {
    if (currentView === 'monthly') {
        currentView = 'quarterly';
        this.textContent = '–ü–æ–º–µ—Å—è—á–Ω–æ';
    } else {
        currentView = 'monthly';
        this.textContent = '–ö–≤–∞—Ä—Ç–∞–ª—å–Ω–æ';
    }
    this.classList.toggle('active');
    renderGantt();
});

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª–∏–∫—É –Ω–∞ –ª–µ–≥–µ–Ω–¥—É
document.querySelectorAll('.legend-item').forEach(item => {
    item.addEventListener('click', function() {
        const okr = this.getAttribute('data-okr');
        
        // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ª–µ–≥–µ–Ω–¥—ã
        document.querySelectorAll('.legend-item').forEach(i => {
            i.classList.remove('filtered');
        });
        
        // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ç–æ—Ç –∂–µ OKR, —á—Ç–æ –∏ —Ä–∞–Ω—å—à–µ - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä
        if (document.getElementById('okrFilter').value === okr) {
            document.getElementById('okrFilter').value = 'all';
        } else {
            // –ò–Ω–∞—á–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä –∏ –æ—Ç–º–µ—á–∞–µ–º –¥—Ä—É–≥–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–∞–∫ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ
            document.getElementById('okrFilter').value = okr;
            document.querySelectorAll('.legend-item').forEach(i => {
                if (i.getAttribute('data-okr') !== okr) {
                    i.classList.add('filtered');
                }
            });
        }
        
        renderGantt();
    });
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
    populateOwnerFilter();
    renderGantt();
});
</script>
</body>
</html> 